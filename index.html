<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>កម្មវិធីគណនាពិន្ទុបាក់ឌុប</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Kantumruy Pro', sans-serif; 
      background: linear-gradient(45deg, #bfdbfe, #ddd6fe, #fef9c3, #fed7aa); 
      background-size: 400%; 
      animation: gradientAnimation 15s ease infinite; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .container { 
      background: rgba(255, 255, 255, 0.15); 
      backdrop-filter: blur(12px); 
      border: 1px solid linear-gradient(to right, #3b82f6, #eab308); 
      border-radius: 20px; 
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.15); 
      padding: 32px;
      max-width: 448px;
      width: 100%;
      margin-bottom: 80px;
    }
    .input-field { 
      background: rgba(255, 255, 255, 0.25); 
      border: none; 
      border-radius: 12px; 
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); 
      transition: all 0.3s ease; 
    }
    .input-field:focus { 
      background: rgba(255, 255, 255, 0.4); 
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.6); 
      outline: none;
    }
    .calculate-btn { 
      background: linear-gradient(to right, #f59e0b, #eab308); 
      border: none; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); 
      transition: all 0.3s ease; 
    }
    .calculate-btn:hover { 
      background: linear-gradient(to right, #eab308, #d97706); 
      box-shadow: 0 6px 20px rgba(234, 179, 8, 0.4); 
    }
    .result-box { 
      background: rgba(255, 255, 255, 0.2); 
      backdrop-filter: blur(10px); 
      border: 1px solid rgba(255, 255, 255, 0.3); 
      border-radius: 16px; 
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); 
    }
    .footer { 
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.15); 
      backdrop-filter: blur(12px); 
      border-top: 1px solid rgba(255, 255, 255, 0.3); 
      padding: 16px;
      text-align: center;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }
    .social-link { 
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      margin: 0 8px;
      border-radius: 50%;
      background: linear-gradient(to right, #3b82f6, #eab308);
      transition: all 0.3s ease;
    }
    .social-link:hover { 
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(234, 179, 8, 0.5);
    }
    .social-link svg { 
      width: 24px;
      height: 24px;
      fill: white;
    }
  </style>
</head>
<body>
  <div class="container text-gray-800">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-900">គណនាពិន្ទុបាក់ឌុប</h1>
    <div class="mb-6">
      <label for="classType" class="block text-sm font-medium mb-2 text-gray-900">ជ្រើសរើសថ្នាក់</label>
      <select id="classType" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-800">
        <option value="science">ថ្នាក់វិទ្យាសាស្ត្រ</option>
        <option value="social">ថ្នាក់សង្គម</option>
      </select>
    </div>
    <div id="inputFields" class="space-y-4"></div>
    <button id="calculateBtn" class="calculate-btn w-full text-white p-3 rounded-lg font-semibold mt-6">គណនា</button>
    <div id="result" class="result-box mt-6 p-4 rounded-lg hidden">
      <h2 class="text-lg font-semibold text-gray-900">លទ្ធផល</h2>
      <div id="subjectGrades" class="mt-2 text-gray-800"></div>
      <div id="finalGrade" class="mt-2 font-bold text-gray-900"></div>
    </div>
  </div>
  <footer class="footer">
    <p class="text-sm text-gray-900 mb-2">ភ្ជាប់ជាមួយយើង</p>
    <div>
      <a href="https://facebook.com/krotanaofficial" target="_blank" class="social-link">
        <svg viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
      </a>
      <a href="https://www.youtube.com/@KongRotanaOfficial" target="_blank" class="social-link">
        <svg viewBox="0 0 24 24"><path d="M23.5 6.2a3 3 0 0 0-2.1-2.1C19.7 3.5 12 3.5 12 3.5s-7.7 0-9.4.6a3 3 0 0 0-2.1 2.1C0 8 0 12 0 12s0 4 .5 5.8a3 3 0 0 0 2.1 2.1c1.7.6 9.4.6 9.4.6s7.7 0 9.4-.6a3 3 0 0 0 2.1-2.1c.5-1.8.5-5.8.5-5.8s0-4-.5-5.8zM9.8 15.1V8.9l6.2 3.1-6.2 3.1z"></path></svg>
      </a>
      <a href="https://t.me/kongrotanaofficialchannel" target="_blank" class="social-link">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm4.2 6.1l-1.8 8.4c-.1.5-.4.6-.8.4l-2.7-2-1.3 1.3c-.1.1-.2.2-.4.2l.2-2.8 5.1-4.6c.2-.2-.1-.3-.3-.1L8.9 11.7l-2.7-.8c-.5-.2-.5-.7.1-.9l10.3-4c.4-.2.7.1.6.4z"></path></svg>
      </a>
      <a href="https://pinterest.com/kongrotanaofficial" target="_blank" class="social-link">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12c0 4.2 2.6 7.8 6.3 9.3-.1-.8-.2-2.1 0-3l1.8-7.6c0-.8-.3-1.5-.8-2.1-.5-.6-1.2-1-2-1-1.6 0-2.8 1.7-2.8 3.8 0 1.5.6 2.8 1.6 3.4.2.1.4.1.5-.1.1-.2.3-.7.4-1 .1-.3 0-.5-.2-.8-.3-.4-.6-.9-.6-1.6 0-1.3.9-2.5 2.1-2.5 1.2 0 2.1.9 2.1 2.2 0 1.3-.7 3.1-1.1 4.8-.3 1.2.5 2.2 1.7 2.2 2 0 3.5-2.4 3.5-5.6 0-3-2.4-5.2-5.5-5.2-2.3 0-4.3 1.7-4.3 4 0 .9.3 1.9.9 2.5.1.1.1.2 0 .3-.1.3-.3.8-.4 1-.1.2-.3.3-.5.2-1.4-.5-2.3-2-2.3-3.4 0-2.8 2.1-5.3 6-5.3 3.3 0 5.9 2.7 5.9 6.1 0 3.4-2.1 6.1-5.1 6.1-1 0-1.9-.5-2.2-1.1l-.6 2.3c-.2.8-.7 1.8-1.1 2.4 1 .3 2 .5 3.1.5 5.5 0 10-4.5 10-10S17.5 2 12 2z"></path></svg>
      </a>
    </div>
  </footer>

  <script>
    const subjectConfigs = {
      science: [
        { name: "គណិតវិទ្យា", max: 125, ranges: { A: [113, 125], B: [100, 112], C: [88, 99], D: [75, 87], E: [63, 74], F: [0, 62] } },
        { name: "អក្សរសាស្ត្រខ្មែរ", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "រូបវិទ្យា", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "គីមីវិទ្យា", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "ជីវវិទ្យា", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "ប្រវត្តិវិទ្យា", max: 50, ranges: { A: [45, 50], B: [40, 45], C: [35, 39], D: [30, 34], E: [25, 29], F: [0, 25] } },
        { name: "ភាសាបរទេស", max: 50, ranges: { A: [45, 50], B: [40, 45], C: [35, 39], D: [30, 34], E: [25, 29], F: [0, 25] } },
      ],
      social: [
        { name: "គណិតវិទ្យា", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "អក្សរសាស្ត្រខ្មែរ", max: 125, ranges: { A: [113, 125], B: [100, 112], C: [88, 99], D: [75, 87], E: [63, 74], F: [0, 62] } },
        { name: "ភូមិវិទ្យា", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "ប្រវត្តិវិទ្យា", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "សីលធម៌-ពលរដ្ឋ", max: 75, ranges: { A: [68, 75], B: [60, 67], C: [53, 59], D: [45, 52], E: [38, 44], F: [0, 37] } },
        { name: "ផែនដី និង បរិស្ថានវិទ្យា", max: 50, ranges: { A: [45, 50], B: [40, 45], C: [35, 39], D: [30, 34], E: [25, 29], F: [0, 25] } },
        { name: "ភាសាបរទេស", max: 50, ranges: { A: [45, 50], B: [40, 45], C: [35, 39], D: [30, 34], E: [25, 29], F: [0, 25] } },
      ],
    };

    const finalGradeRanges = {
      A: [427.5, Infinity],
      B: [380, 427],
      C: [333, 379],
      D: [285, 331],
      E: [237, 284],
      F: [0, 236],
    };

    const classTypeSelect = document.getElementById("classType");
    const inputFieldsDiv = document.getElementById("inputFields");
    const calculateBtn = document.getElementById("calculateBtn");
    const resultDiv = document.getElementById("result");
    const subjectGradesDiv = document.getElementById("subjectGrades");
    const finalGradeDiv = document.getElementById("finalGrade");

    function renderInputFields(classType) {
      inputFieldsDiv.innerHTML = "";
      subjectConfigs[classType].forEach((subject) => {
        const div = document.createElement("div");
        div.innerHTML = `
          <label class="block text-sm font-medium text-gray-900">${subject.name} (អតិបរមា: ${subject.max})</label>
          <input type="number" data-subject="${subject.name}" class="input-field mt-1 block w-full p-3 border-none rounded-lg text-gray-800" max="${subject.max}" min="0" step="0.5">
        `;
        inputFieldsDiv.appendChild(div);
      });
    }

    function getGrade(score, ranges) {
      for (let grade in ranges) {
        const [min, max] = ranges[grade];
        if (score >= min && score <= max) return grade;
      }
      return "F";
    }

    function calculateScores() {
      const classType = classTypeSelect.value;
      const inputs = inputFieldsDiv.querySelectorAll("input");
      let totalScore = 0;
      let results = [];
      let invalidSubjects = [];

      let isValid = true;
      inputs.forEach((input) => {
        const score = parseFloat(input.value) || 0;
        const subjectName = input.dataset.subject;
        const subject = subjectConfigs[classType].find((s) => s.name === subjectName);
        if (score > subject.max || score < 0) {
          input.classList.add("border-red-500");
          invalidSubjects.push(subjectName);
          isValid = false;
          return;
        }
        input.classList.remove("border-red-500");
        const grade = getGrade(score, subject.ranges);
        results.push(`${subjectName}: ${score} (និទ្ទេស ${grade})`);
        totalScore += score;
      });

      if (!isValid) {
        alert(`ពិន្ទុមិនត្រឹមត្រូវសម្រាប់: ${invalidSubjects.join(", ")}។ សូមបញ្ចូលពិន្ទុក្នុងចន្លោះអតិបរមា។`);
        return;
      }

      const finalGrade = getGrade(totalScore, finalGradeRanges);
      const passMessage = finalGrade !== "F" ? "អបអរសាទរ! អ្នកបានជាប់" : "សូមព្យាយាមម្តងទៀតនៅឆ្នាំក្រោយ";
      subjectGradesDiv.innerHTML = results.join("<br>");
      finalGradeDiv.innerHTML = `ពិន្ទុសរុប: ${totalScore} (និទ្ទេស ${finalGrade})<br>${passMessage}`;
      resultDiv.classList.remove("hidden");

      // Update Telegram Main Button
      window.Telegram.WebApp.MainButton.setText("គណនាម្តងទៀត");
      window.Telegram.WebApp.MainButton.show();
    }

    // Initialize Telegram Web App
    window.Telegram.WebApp.ready();
    window.Telegram.WebApp.expand();
    window.Telegram.WebApp.MainButton.setText("គណនា");
    window.Telegram.WebApp.MainButton.onClick(calculateScores);
    window.Telegram.WebApp.MainButton.show();

    // Event Listeners
    classTypeSelect.addEventListener("change", () => {
      renderInputFields(classTypeSelect.value);
      resultDiv.classList.add("hidden");
    });
    calculateBtn.addEventListener("click", calculateScores);

    // Initial Render
    renderInputFields("science");
  </script>
</body>
</html>